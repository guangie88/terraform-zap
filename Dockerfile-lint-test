FROM guangie88/rs-cider:1.28.0

WORKDIR /app
COPY ./Cargo.toml ./Cargo.lock ./rustfmt.toml ./
COPY ./ignore-lib/Cargo.toml ./ignore-lib/rustfmt.toml ./ignore-lib/

RUN set -x \
    && cargo fetch --locked -v

COPY ./src/ ./src/
COPY ./ignore-lib/src/ ./ignore-lib/src/

RUN cargo +nightly clippy --all \
    && cargo test --all --no-run
